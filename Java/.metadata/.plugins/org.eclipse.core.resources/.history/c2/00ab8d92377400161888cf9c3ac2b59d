import java.awt.Color;

import rennyu.RFrame;

public class Main{
	public static RFrame frame;
	public static Blopic bp;

	public static void led(byte count){
		byte data[]={1,0};
		byte key=1;
		if(bp.hash.containsKey(key)){
			for(byte i=0;i<bp.hash.get(key).size();i++){
				data[0]=(byte)bp.hash.get(key).get(i);
				if(count==i){
					data[1]=(byte)1;
				}
				else{
					data[1]=(byte)0;
				}
				bp.query(data);
			}
		}
	}
	public static int getVal(){
		byte data[]={3,0,1,2};
		byte key=3;
		int val=-1;
		if(bp.hash.containsKey(key)){
			data[0]=(byte)bp.hash.get(key).get(0);
			String[] res=bp.query(data);
			val=(int)(Short.parseShort(res[1])<<8|Short.parseShort(res[2]));
		}
		return val;
	}
	public static void main(String[] args) {
		try{
			if(args.length!=1)throw new Exception();
			frame=new RFrame("Blopic",640,480,(byte) 60);
			frame.setVisible(true);
			bp=new Blopic(args[0]);
			bp.load();
			byte count=1;
			int v;
			while(!frame.update()){
				frame.drawBox(0, 0, frame.getWidth(),frame.getHeight(),Color.BLACK,true);
				if((v=getVal())>512){
					led((byte)0);
				}
				else{
					led((byte)1);
				}
				frame.drawString(20,50,new Color(255,255,255),String.valueOf(v));
				for(int i=0;i<bp.list.size();i++){
					Color col;
					switch(Integer.parseInt(bp.list.get(i).split(":")[1])){
					case 1:col=new Color(255,0,0);break;
					case 2:col=new Color(0,255,0);break;
					case 3:col=new Color(0,0,255);break;
					case 4:col=new Color(255,255,0);break;
					default:col=new Color(0,0,0);break;
					}
					frame.drawBox(20+i*20+i*5,100,20+(i+1)*20+i*5,120,col,true);
				}
			}
			bp.close();
			frame.setVisible(false);
			System.exit(0);
		}catch(Exception e){
			if(bp!=null)bp.close();
			if(frame!=null)frame.setVisible(false);
			e.printStackTrace();
			System.exit(0);
		}
	}
}
